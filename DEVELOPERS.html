<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Notes for developers • nhstt</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="Notes for developers"><!-- Privacy-friendly analytics by Plausible --><script async src="https://plausible.io/js/pa-dJqtwvYY2LG5zy4L5xF4g.js"></script><script>
  window.plausible = window.plausible || function() {
    (plausible.q = plausible.q || []).push(arguments)
  },
  plausible.init = plausible.init || function(i) {
    plausible.o = i || {};
  };
  plausible.init()
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">nhstt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Function reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-how-to-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">How-to guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-how-to-guides"><li><h6 class="dropdown-header" data-toc-skip>Annual data</h6></li>
    <li><a class="dropdown-item" href="articles/how-to-key-measures-annual.html">Key measures</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Monthly data</h6></li>
    <li><a class="dropdown-item" href="articles/how-to-activity-performance-monthly.html">Activity and performance</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-metadata" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Metadata</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-metadata"><li><h6 class="dropdown-header" data-toc-skip>Annual metadata</h6></li>
    <li><a class="dropdown-item" href="articles/metadata-annual.html">Key measures</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Monthly metadata</h6></li>
    <li><a class="dropdown-item" href="articles/metadata-monthly-core.html">Core measures</a></li>
    <li><a class="dropdown-item" href="articles/metadata-monthly-ea.html">Employment Advisor (EA) measures</a></li>
    <li><a class="dropdown-item" href="articles/metadata-monthly-ltc.html">Long-term Condition (LTC) measures</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Organisation metadata</h6></li>
    <li><a class="dropdown-item" href="articles/metadata-ods.html">NHS Talking Therapies providers</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports"><li><h6 class="dropdown-header" data-toc-skip>Monthly</h6></li>
    <li><a class="dropdown-item" href="articles/report-monthly-tx-appt.html">Appointment measures</a></li>
    <li><a class="dropdown-item" href="articles/report-monthly-outcomes.html">Outcome measures</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bennettoxford/nhstt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Notes for developers</h1>
      <small class="dont-index">Source: <a href="https://github.com/bennettoxford/nhstt/blob/main/DEVELOPERS.md" class="external-link"><code>DEVELOPERS.md</code></a></small>
    </div>

<div id="notes-for-developers" class="section level1">

<div class="section level2">
<h2 id="system-requirements">System requirements<a class="anchor" aria-label="anchor" href="#system-requirements"></a></h2>
<ul><li><a href="https://github.com/casey/just" class="external-link">just</a></li>
<li>R (version 4.0 or higher)</li>
<li>
<a href="https://github.com/posit-dev/air/" class="external-link">air</a> for code formatting</li>
</ul></div>
<div class="section level2">
<h2 id="local-development-environment">Local development environment<a class="anchor" aria-label="anchor" href="#local-development-environment"></a></h2>
<p>The <code>just</code> command provides a list of available recipes, most of them are also available as shortcuts in Positron or RStudio:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">just</span> list</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="r-package-development">R package development<a class="anchor" aria-label="anchor" href="#r-package-development"></a></h2>
<ul><li><a href="https://r-pkgs.org/" class="external-link">R Packages (2e) by Hadley Wickham and Jennifer Bryan</a></li>
<li><a href="https://adv-r.hadley.nz/" class="external-link">Advanced R by Hadley Wickham</a></li>
<li><a href="https://cran.r-project.org/doc/FAQ/R-exts.html#Creating-R-packages" class="external-link">Creating R packages Kurt Hornik and the R Core Team</a></li>
</ul></div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p>Unit tests are implemented with <em>teststhat</em> in <code>tests/testthat</code> (run <code>just test-unit</code>). To keep unit tests fast but still test the full pipeline (download and tidy) integration tests are in <code>tests/integration.R</code> (run <code>just test-integration</code>). There may be a way to also add integration tests to testthat without running them every time (possible using environment variables), but I haven’t explored that yet. The just recipe <code>just test</code> runs both tests.</p>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h2>
<p>Documentation is built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>.</p>
</div>
<div class="section level2">
<h2 id="development-workflow">Development workflow<a class="anchor" aria-label="anchor" href="#development-workflow"></a></h2>
<ol style="list-style-type: decimal"><li>Install package locally: <code>just build</code> (or <code><a href="https://pak.r-lib.org/reference/local_install.html" class="external-link">pak::local_install()</a></code>)</li>
<li>Make changes to code</li>
<li>Run <code>just fix</code> to format</li>
<li>Run <code>just document</code> if you changed roxygen2 docs</li>
<li>Run <code>just test</code> to verify tests pass</li>
<li>For schema updates: <code>just update-schemas</code>
</li>
<li>Run <code>just check</code> before submitting a PR</li>
<li>Update docs with <code>just docs</code> if needed</li>
</ol></div>
<div class="section level2">
<h2 id="configuration-files">Configuration files<a class="anchor" aria-label="anchor" href="#configuration-files"></a></h2>
<p>Data sources and transformations are defined in <code>inst/config/</code> as YAML files:</p>
<p><strong>Raw data sources</strong> (archives, URLs, periods): - <code>raw_annual_data_config.yml</code>: Annual datasets - <code>raw_monthly_data_config.yml</code>: Monthly datasets - <code>raw_metadata_config.yml</code>: Metadata</p>
<p><strong>Tidy transformations</strong> (filters, derivations, output columns): - <code>tidy_annual_data_config.yml</code> - <code>tidy_monthly_data_config.yml</code> - <code>tidy_metadata_config.yml</code></p>
<p><strong>Schemas</strong> (auto-generated column tracking): - Run <code>just update-schemas</code> after modifying <code>raw_annual_data_config.yml</code> - Schemas saved to <code>inst/schemas/annual_main_schemas.csv</code></p>
</div>
<div class="section level2">
<h2 id="dev-utilities">Dev utilities<a class="anchor" aria-label="anchor" href="#dev-utilities"></a></h2>
<p>Internal functions in <code>R/dev-utils.R</code> help explore archive contents before exposing new data through the package: - <code>list_available_archives()</code>: See all archives and periods - <code>list_archive_files("annual_main", "2024-25")</code>: List CSV files in an archive - <code>read_archive_file("annual_main", "2024-25", "main")</code>: Read specific files - <code>compare_schemas("main")</code>: Compare column changes across periods</p>
<p>Access via <code>devtools::load_all()</code> or <code>nhstt:::function_name()</code>.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Milan Wiedemann, Lola Ojedele, Wellcome Trust.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

